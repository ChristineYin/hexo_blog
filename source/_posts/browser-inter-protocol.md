---
title: 互联网协议
date: 2020-06-05 16:07:30
tags:
  - 协议
excerpt: 我们生活在一个互联网的时代，搜索一个东西就可以显示，发送一条消息对方就能看到，那么这之间发生了什么？这一切的基础都需归结会互联网协议，它就是一系列的规则，就如同在社会中，我们有法律来约束个人行为，法律就可以看做是一种面向公民的"协议"，在互联网中也形成了一些协议，主要用来约束设备和程序的行为完成相互通信。
---

我们生活在一个互联网的时代，搜索一个东西就可以显示，发送一条消息对方就能看到，那么这之间发生了什么？这一切的基础都需归结会互联网协议，它就是一系列的规则，就如同在社会中，我们有法律来约束个人行为，法律就可以看做是一种面向公民的"协议"，在互联网中也形成了一些协议，主要用来约束设备和程序的行为完成相互通信。

## 五层模型

互联网的通讯模型可以分成 5 层来理解，每层都有自己的功能。其中物理层是最底层的，应用层是最高层，中间分别是数据链路层、网络层、传输层，其中每一层都建立在上一层的基础上。

![ts9KpT.png](https://s1.ax1x.com/2020/06/05/ts9KpT.png)

## 物理层

如果你想搜索一个东西，首先得有设备（手机或者电脑等），其次你还得连网，即可以连 WIFI，也可以插网线等方式，每个人都如此操作，便形成了一个巨大的网络，也就是我们所说的互联网，那么连接的方式就是物理层，它主要规定了网络的一些电气特性，作用是负责传送 0 和 1 的电信号。

## 链路层

物理层使得两台设备之间可以传输 0 和 1 的电信号，但是仅由 0 和 1 组成的一系列序号是没有意义，还需要一种方式可以解读传送的信息。所以这就是链路层的作用，那么具体的传输过程是如何呢？

1. 首先是对电信号进行分组。我们现在使用的分组方式是遵循的以太网协议，它规定了每组电信号的传输都由两部分组成，第一部分是标头，主要包含了发送者、接受者、数据类型等说明信息，第二部分是数据，主要就是消息内容。标头和数据作为一组电信号构成了一个数据包，叫做"帧"。
2. 然后传输终端，传输就好像邮寄，邮寄有两个重要的部分就是发送者信息和接受者信息，同理，电信号的传输亦是如此。那么它是怎么做的呢？鉴于此以太网规定所有连入网络的设备都需有网卡接口，网卡的地址即是数据发送和接受的地址，被成为 MAC 地址（每个网卡都有世界独一无二的 MAC 地址）。
3. 最后是怎么传输，既然我们用了信息，也有了接收方，那么在诺大的网络中，如何知道谁是接收方呢？对此以太网也做了规定，它采用了发送数据包到本网络内的所有计算机，让其他所有的计算机自己判断，如果发送的标头中接收方的 MAC 地址和自己匹配就接收，否则就不处理，这种方式也叫"广播"。

## 网络层

至此我们已经了解，如何在设备之间传输数据，但是上述"广播"方式存在一个很严重的弊端，那就是消息发送太广泛，如果诺大个互联网都如此通信，非瘫痪不可。那有什么好的方式优化呢？

这就要说到网络层了，在网络层中规定了，数据的"广播"方式只能在同一子网络内发送，不同网络之间采用另一种路由方式，因为 MAC 地址无法满足这个需求，它只与厂商有关，而与所处网络无关。所以便又引入了网络层，它用来定义一个新的地址，用于区分计算机所处网络，这个新的地址即"网络地址"。

用于管理网络地址的协议，称为 IP 协议，它所定义的地址被成为 IP 地址。同样的，IP 数据包也分为标头和数据两部分，标头主要保罗 IP 地址、长度等，数据部分是具体信息。为了不影响链路层数据包的封装，所以将 IP 数据包放在链路层数据包的数据部分。

## 传输层

通过上面的介绍，我们知道两台设备之间发送信息，需要先确定 IP 地址 和 MAC 地址。但是如果你的设备同时开着多个程序，那么这条信息如何知道是传递给谁的呢？所以还需要一个参数来用来标识数据是要发给那个程序的，这个参数就是端口 port。所以这就是传输层的功能，决定了端口到端口的通信。

增加了新的参数，传输的数据包中也必然要增加参数信息，那么也要引入新的协议用来管理，所以也就有了 UDP 协议和 TCP 协议。

1. UDP 协议。UDP 的数据包也是由标头和数据两部分组成，标头定义了端口信息，数据部分是具体的内容，然后把 UDP 数据包放到 IP 数据包的数据部分。
2. TCP 协议。TCP 协议比 UDP 协议更可靠一些，因为它会对发送的数据包进行重发、确认等操作。标头和数据部分的定义同 UDP 协议。

## 应用层

通过以上步骤，数据终于到了目的地，但是问题又出现了，如果所有传输的数据格式不一致，那么如何以固定的方式去解析呢？ 所以还需要定义一种传输格式，用来保证大家都以相同的形式发送，然后接受方也可以做统一的处理，因此也就出现了应用层。我们常见的应用层协议有 HTTP 协议用于浏览器请求数据、FTP 协议用于下载文件等等。

参考：http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html
